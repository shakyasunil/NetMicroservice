name: "Build for PRe"
description: "Builds a docker image without pushing"
inputs:
  service:
    description: "Service to build"
    required: true
  dotnet_version:
    description: "Service to build"
    required: true
runs:
  using: "composite"
  steps:
  - uses: actions/checkout@v2
  - name: Setup .NET Core
    uses: actions/setup-dotnet@v1
    with:
      dotnet-version: ${{ inputs.dotnet_version }}  
  - name: Install dependencies
    run: dotnet restore
    shell: pwsh
    working-directory: ./services/${{ inputs.service }}  
  - name: Compose build ${{ inputs.service }}
    shell: pwsh
    run: |
      $files = Get-ChildItem "..\..\"
      foreach ($f in $files){
          $outfile = $f.FullName + "out" 
          Get-Content $f.FullName | Where-Object { ($_ -match 'step4' -or $_ -match 'step9') } | Set-Content $outfile
      }
      dotnet build --configuration Release --no-restore   -p:PublishSingleFile=true --output .\bin\publish\dll
      Compress-Archive .\bin\publish\dll\* ..\..\${{ inputs.service }}.zip
    working-directory: ./services/${{ inputs.service }}
